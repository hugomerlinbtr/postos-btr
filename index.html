<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Postos Próximos - BTR</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; background: #f5f5f5; }
    h1 { font-size: 1.5rem; }
    .posto { background: white; margin: 1rem 0; padding: 1rem; border-radius: 8px; box-shadow: 0 0 8px #ccc; }
    button { margin-top: 0.5rem; padding: 0.5rem 1rem; border: none; background: #007BFF; color: white; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Postos autorizados mais próximos</h1>
  <div id="resultado">Buscando localização...</div>

  <script>
    const postos = [
      { nome: "Posto GP", cidade: "Juranda", lat: -24.347303, lng: -52.734351 },
      { nome: "Posto Idaza", cidade: "Foz do Iguaçu", lat: -25.503347, lng: -54.539150 },
      { nome: "Posto Gasparin", cidade: "Foz do Iguaçu", lat: -25.486981, lng: -54.503001 },
      { nome: "Auto Posto Rudnick", cidade: "Joinville", lat: -26.184622, lng: -48.908641 },
      { nome: "Graal GP", cidade: "Piçarras", lat: -26.779005, lng: -48.684201 }
    ];

    function calcularDistancia(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = 
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function mostrarPostos(userLat, userLng) {
      const container = document.getElementById("resultado");
      container.innerHTML = "";
      
      const ordenados = postos.map(p => {
        const dist = calcularDistancia(userLat, userLng, p.lat, p.lng);
        return { ...p, distancia: dist };
      }).sort((a, b) => a.distancia - b.distancia);

      ordenados.forEach(p => {
        const div = document.createElement("div");
        div.className = "posto";
        div.innerHTML = `
          <strong>${p.nome}</strong><br>
          Cidade: ${p.cidade}<br>
          Distância: ${p.distancia.toFixed(2)} km<br>
          <a href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lng}" target="_blank">
            <button>Navegar</button>
          </a>
        `;
        container.appendChild(div);
      });
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude } = pos.coords;
          mostrarPostos(latitude, longitude);
        },
        err => {
          document.getElementById("resultado").innerText = "Não foi possível acessar sua localização.";
        }
      );
    } else {
      document.getElementById("resultado").innerText = "Geolocalização não suportada pelo navegador.";
    }
  </script>
</body>
</html>
